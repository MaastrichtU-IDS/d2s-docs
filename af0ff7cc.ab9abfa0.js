(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{104:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return c})),n.d(t,"toc",(function(){return l})),n.d(t,"default",(function(){return d}));var a=n(3),r=n(7),i=(n(0),n(125)),o={id:"guide-docker",title:"Docker guide"},c={unversionedId:"guide-docker",id:"guide-docker",isDocsHomePage:!1,title:"Docker guide",description:"This guide aims to give some insights about running Docker containers, volumes and networks directly using docker run.",source:"@site/docs/guide-docker.md",slug:"/guide-docker",permalink:"/docs/guide-docker",editUrl:"https://github.com/MaastrichtU-IDS/d2s-docs/edit/master/website/docs/guide-docker.md",version:"current",lastUpdatedBy:"Vincent Emonet",lastUpdatedAt:1610646383,sidebar:"docs",previous:{title:"Preprocess input files",permalink:"/docs/guide-preprocessing"},next:{title:"Experimental Jenkins workflows",permalink:"/docs/guide-jenkins"}},l=[{value:"Basic Docker commands",id:"basic-docker-commands",children:[{value:"Run a container",id:"run-a-container",children:[]},{value:"Stop a container",id:"stop-a-container",children:[]},{value:"Share volumes",id:"share-volumes",children:[]}]},{value:"Link and network",id:"link-and-network",children:[{value:"Network",id:"network",children:[]},{value:"Link",id:"link",children:[]}]}],b={toc:l};function d(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(a.a)({},b,n,{components:t,mdxType:"MDXLayout"}),Object(i.b)("p",null,"This guide aims to give some insights about running ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.docker.com/"}),"Docker")," containers, volumes and networks directly using ",Object(i.b)("inlineCode",{parentName:"p"},"docker run"),"."),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},"\ud83d\udeab This page does not aims to be a comprehensive Docker tutorial, see the ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://docs.docker.com/get-started/"}),"official documentation")," if you want to know more about Docker.")),Object(i.b)("hr",null),Object(i.b)("h2",{id:"basic-docker-commands"},"Basic Docker commands"),Object(i.b)("h3",{id:"run-a-container"},"Run a container"),Object(i.b)("p",null,"A Docker image can be run to create a container in 2 ways"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"-it")," Interactive: the process is attached to the terminal and you can stop it using ctrl+C"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"-d")," Detached: the process is detached and will continue if you exit the terminal.")),Object(i.b)("hr",null),Object(i.b)("h3",{id:"stop-a-container"},"Stop a container"),Object(i.b)("p",null,"To get a Docker container ID and stop it:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),"docker ps\ndocker stop my-container\n")),Object(i.b)("p",null,"Automatically delete a container after run\nYou can use the ",Object(i.b)("inlineCode",{parentName:"p"},"--rm")," flag to automatically delete a container after its run. It avoid accumulating containers and wasting memory."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),"docker run -it --rm my-container\n")),Object(i.b)("hr",null),Object(i.b)("h3",{id:"share-volumes"},"Share volumes"),Object(i.b)("p",null,"A lot of images will require input files, the best way to provide them is to share a volume from your system to the container. It can be done by using ",Object(i.b)("inlineCode",{parentName:"p"},"-v")," when ",Object(i.b)("inlineCode",{parentName:"p"},"docker run"),"."),Object(i.b)("p",null,"Let's say I have a ",Object(i.b)("inlineCode",{parentName:"p"},"/data/d2s-workspace/my-file.txt")," on my system, and I want to provide it as a container input file. "),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"I need to provide he ",Object(i.b)("inlineCode",{parentName:"li"},"-v")," flag with paths separated by a ",Object(i.b)("inlineCode",{parentName:"li"},":"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"before the user provide the path of the shared volume on his system"),Object(i.b)("li",{parentName:"ul"},"after the user provide the path it will be accessible from in the Docker container")))),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),'docker run -it -v /path/on/my/computer:/path/in/container my-container \\\n    --input-file "/path/in/container/my-file.txt"\n')),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"In this example we are sharing the ",Object(i.b)("inlineCode",{parentName:"li"},"/data/d2s-workspace")," volume from our system to ",Object(i.b)("inlineCode",{parentName:"li"},"/data")," in the Docker container. ",Object(i.b)("em",{parentName:"li"},"my-file.txt")," is then accessible as ",Object(i.b)("inlineCode",{parentName:"li"},"/data/my-file.txt")," in the container")),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),'docker run -it -v /data/d2s-workspace:/data my-container \\\n    --input-file "/data/my-file.txt"\n')),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Windows requires to provide the drive when sharing volume (e.g. ",Object(i.b)("inlineCode",{parentName:"li"},"c:"),") and the command to be one line.")),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),'docker run -it -v c:/data/d2s-workspace:/data my-container --input-file "/data/my-file.txt"\n')),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"We usually provide a relative path using ",Object(i.b)("inlineCode",{parentName:"li"},"$pwd)"))),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),'docker run -it -v $(pwd)/workspace:/data my-container --input-file "/data/my-file.txt"\n')),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},"To be tested on Windows.")),Object(i.b)("hr",null),Object(i.b)("h2",{id:"link-and-network"},"Link and network"),Object(i.b)("p",null,"Containers can be linked using 2 ways: ",Object(i.b)("inlineCode",{parentName:"p"},"--link")," flag and ",Object(i.b)("inlineCode",{parentName:"p"},"--network"),"."),Object(i.b)("h3",{id:"network"},"Network"),Object(i.b)("p",null,"Especially used when running services using docker-compose. The ",Object(i.b)("inlineCode",{parentName:"p"},"--link")," flag method can be easier to use in simple cases."),Object(i.b)("h4",{id:"example-of-a-network-setup-in-the-docker-composeyml"},"Example of a network setup in the ",Object(i.b)("a",Object(a.a)({parentName:"h4"},{href:"https://github.com/MaastrichtU-IDS/data2services-pipeline/blob/master/docker-compose.yml"}),"docker-compose.yml")),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml"}),'version: "3"\nservices:\n  drill:\n    build: ./apache-drill\n    volumes:\n      - /data:/data:ro\n    ports:\n      - 8047:8047\n      - 31011:31010\n    tty: true\n    networks:\n      - network\n  \n  graphdb:\n    build: ./graphdb\n    volumes:\n      - /data/graphdb:/opt/graphdb/home\n      - /data/graphdb-import:/root/graphdb-import\n    ports:\n      - 7200:7200\n    networks:\n      - network\n  \nnetworks:\n  network:\n    driver: bridge\n')),Object(i.b)("h4",{id:"example-of-autor2rml-connecting-to-the-drill-container-through-a-network"},"Example of AutoR2RML connecting to the Drill container through a network"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),'docker run -it --rm -v /data:/data \\\n  --network network-pipeline_data2services \\\n  autor2rml -r \\\n  -j "jdbc:drill:drillbit=data2services-pipeline_drill_1:31011" \\\n  -o "/data/d2s-workspace/mapping.trig" -d "/data/d2s-workspace" -g "http://data2services/graph/autor2rml"\n')),Object(i.b)("hr",null),Object(i.b)("h3",{id:"link"},"Link"),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"--link")," is deprecated, Docker recommends to use ",Object(i.b)("inlineCode",{parentName:"p"},"--network"),". But the ",Object(i.b)("inlineCode",{parentName:"p"},"--link")," flag can be more convenient to use in simple case: e.g. when linking to a single service, you just need to provide the container name instead of setting up a whole network."),Object(i.b)("h4",{id:"how-to-use-link"},"How to use link"),Object(i.b)("p",null,"Let's say you have a frontend application that needs to query a backend application."),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Run the backend")),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),"docker run -it --rm --name backend -p 8080:8080 backend-image\n")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"To access it as http://localhost:8080 in the frontend")),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),"docker run -it --rm --name frontend --link backend:localhost frontend-image\n")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"To access it as http://backend:8080 in the frontend")),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),"docker run -it --rm --name frontend --link backend:backend frontend-image\n")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"You can link to multiple backend in a frontend")),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),"docker run -it --rm --name frontend --link backend-sql:backend-sql --link backend-redis:backend-redis frontend-image\n")),Object(i.b)("h4",{id:"example-of-autor2rml-connecting-to-drill-container-using-link"},"Example of AutoR2RML connecting to Drill container using link"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),'# Run Apache Drill service\ndocker run -dit --rm -p 8047:8047 -p 31011:31010 --name drill -v /data:/data:ro apache-drill\n\n# Run AutoR2RML, linking to the Apache Drill container\ndocker run -it --rm --link drill:drill -v /data:/data autor2rml \\\n    -j "jdbc:drill:drillbit=drill:31010" -r \\\n        -o "/data/d2s-workspace/mapping.trig" -d "/data/d2s-workspace" -g "http://data2services/graph/autor2rml"\n')))}d.isMDXComponent=!0},125:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return m}));var a=n(0),r=n.n(a);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var b=r.a.createContext({}),d=function(e){var t=r.a.useContext(b),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},s=function(e){var t=d(e.components);return r.a.createElement(b.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},u=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,o=e.parentName,b=l(e,["components","mdxType","originalType","parentName"]),s=d(n),u=a,m=s["".concat(o,".").concat(u)]||s[u]||p[u]||i;return n?r.a.createElement(m,c(c({ref:t},b),{},{components:n})):r.a.createElement(m,c({ref:t},b))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=u;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:a,o[1]=c;for(var b=2;b<i;b++)o[b]=n[b];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"}}]);