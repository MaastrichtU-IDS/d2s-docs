---
title: Use case - Geoeconomics
author: Vincent Emonet
authorURL: vemonet.github.io/
---


Generate a RDF knowledge graph integrating geographical and economics data from **[WorldBank](https://data.worldbank.org/indicator/NY.GDP.MKTP.CD)** and **[GeoNames](https://www.geonames.org/)**.

<!--truncate-->

## Generate datasets

Generate the WorldBank and GeoNames datasets:

```shell
d2s generate dataset
# Follow prompt instructions to set the dataset metadata
d2s generate dataset
```

The folder with the RML mappings, metadata and download files are generated in `datasets/worldbank` and `datasets/geonames`

## Define download files

Define a simple bash script to download WorldBank XML from its GitHub URL in `datasets/worldbank/download/download.sh`:

```shell
#!/bin/bash
## Download XML file from GitHub
wget -N https://raw.githubusercontent.com/MaastrichtU-IDS/UM_KEN4256_KnowledgeGraphs/master/dataset-worldbank-gdp-full.xml
wget -N https://raw.githubusercontent.com/MaastrichtU-IDS/UM_KEN4256_KnowledgeGraphs/master/dataset-worldbank-gdp.xml
```

Same for GeoNames:

```shell
#!/bin/bash
## Download TSV file from GitHub
wget -N https://raw.githubusercontent.com/MaastrichtU-IDS/UM_KEN4256_KnowledgeGraphs/master/dataset-geonames-countryInfo.csv
```

## Improve metadata

We improved the metadata for GeoNames and WorldBank datasets by editing those files:

* `datasets/worldbank/metadata/metadata-template-0-summary.rq`
* `datasets/worldbank/metadata/metadata-template-1.rq`
* `datasets/geonames/metadata/metadata-template-0-summary.rq`
* `datasets/geonames/metadata/metadata-template-1.rq`

> To edit metadata such as keywords, theme, homepage, download URL, etc.

## Define RML mapping files

Some [templates mapping files](https://github.com/MaastrichtU-IDS/d2s-cwl-workflows/tree/master/support/template/dataset/mapping) are generated when creating a new dataset to help start mappings different king of file. Delete them and define mapping files for WorldBank and GeoName.

* WorldBank mappings in [datasets/worldbank/mapping/gdp_mapping.rml.ttl](https://github.com/MaastrichtU-IDS/d2s-transform-template/blob/master/datasets/worldbank/mapping/gdp_mapping.rml.ttl)

* GeoName mappings in [datasets/geonames/mapping/country_mapping.rml.ttl](https://github.com/MaastrichtU-IDS/d2s-transform-template/blob/master/datasets/geonames/mapping/country_mapping.rml.ttl)

* Additional mapping file to map WorldBank and GeoNames using ISO2 and ISO3 code correspondance in [datasets/geonames/mapping/iso_mapping.rml.ttl](https://github.com/MaastrichtU-IDS/d2s-transform-template/blob/master/datasets/geonames/mapping/iso_mapping.rml.ttl)

## Download input files

Use the `d2s` tool to download datasets files defined in their respective `download/download.sh` file:

```shell
d2s download worldbank
d2s download geonames
```

Here is a sample of the CSV file used to map ISO2 and ISO3:

```
ISO,ISO3
AD,AND
AE,ARE
```

## Run the RMLMapper

Fix input file permissions:

```shell
sudo chmod -R 777 workspace/input 
```

Start the data transformation

```shell
d2s rml worldbank --mapper
d2s rml geonames --mapper --watch 
```

> Ntriple files generated in `workspace/import`

The `RMLStreamer` can also be used, it is faster and more scalable, but its development is not has advanced as the rmlmapper and in this use-case it is facing issues with RML conversion of WorldBank. So we used the RMLMapper which properly generates the triples, but takes longer (about 40min on my laptop).

Instructions to run the RMLStreamer:

 ```shell
d2s start rmlstreamer rmltask
d2s rml worldbank --streamer --watch
d2s rml geonames --streamer --watch
 ```

> See running jobs at http://localhost:8078

## Load the generated triples

Start Ontotext GraphDB triplestore locally.

This can be done using `d2s` if you previously downloaded and set the GraphDB installation file.

```shell
d2s start graphdb
```

* Go to http://localhost:7200
  * Create a repository (e.g. `geoeconomics`). Enable `Use context index`.
* The files generated by the RML mapper should be available at http://localhost:7200/import#server
  * For the KG course we would have load the ntriples generated by the RML mappings for GeoNames and WorldBank in the "Named graph" http://kg-course/mapping
  * But in this use case we will load WorldBank and GeoNames data in separated graphs to be able to compute metadata about them.
    * https://w3id.org/d2s/graph/worldbank
    * https://w3id.org/d2s/graph/geonames
  * Load the ntriples generated by the ISO mappings in the Named graph http://kg-course/interlinking

## Browse the built Knowledge Graph

The [into-the-graph Web UI](https://d2s.semanticscience.org/docs/services-interfaces#into-the-graph) can be used to browse the SPARQL endpoint hosting the generated RDF Knowledge Graph.

Access the Knowledge Graph we built at http://trek.semanticscience.org/describe?uri=https://w3id.org/d2s/graph/geonames&endpoint=http://graphdb.dumontierlab.com/repositories/geoeconomics

> Make sure the SPARQL endpoint URL is set on [http://graphdb.dumontierlab.com/repositories/geoeconomics](http://trek.semanticscience.org/describe?uri=https://w3id.org/d2s/graph/geonames&endpoint=http://graphdb.dumontierlab.com/repositories/geoeconomics)

## Optional: compute and load metadata

Edit the config.yml to define the parameters of the workflow that will compute metadata for the dataset

* sparql_final_graph_uri: your graph
  * e.g. https://w3id.org/d2s/graph/geonames

* sparql_final_triplestore_url: SPARQL endpoint to compute and load the RDF 
  * e.g. http://graphdb:7200/repositories/geoeconomics/statements
* sparql_final_triplestore_username
  * e.g. admin
* sparql_final_triplestore_password
  * e.g. password

Fix permissions: `d2s update --permissions`

Run the [CWL workflows](https://www.commonwl.org/) (not supported on Windows at the moment):

```shell
d2s run compute-hcls-metadata.cwl worldbank
d2s run compute-hcls-metadata.cwl geonames
```

