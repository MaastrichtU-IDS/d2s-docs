(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{113:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return l})),t.d(n,"metadata",(function(){return c})),t.d(n,"toc",(function(){return d})),t.d(n,"default",(function(){return s}));var a=t(3),r=t(7),i=(t(0),t(141)),o=["components"],l={id:"guide-docker",title:"Docker guide"},c={unversionedId:"guide-docker",id:"guide-docker",isDocsHomePage:!1,title:"Docker guide",description:"This guide aims to give some insights about running Docker containers, volumes and networks directly using docker run.",source:"@site/docs/guide-docker.md",slug:"/guide-docker",permalink:"/docs/guide-docker",editUrl:"https://github.com/MaastrichtU-IDS/d2s-docs/edit/master/website/docs/guide-docker.md",version:"current",lastUpdatedBy:"Vincent Emonet",lastUpdatedAt:1645438229,sidebar:"docs",previous:{title:"Preprocess input files",permalink:"/docs/guide-preprocessing"},next:{title:"Experimental Jenkins workflows",permalink:"/docs/guide-jenkins"}},d=[{value:"Basic Docker commands",id:"basic-docker-commands",children:[{value:"Run a container",id:"run-a-container",children:[]},{value:"Stop a container",id:"stop-a-container",children:[]},{value:"Share volumes",id:"share-volumes",children:[]}]},{value:"Link and network",id:"link-and-network",children:[{value:"Network",id:"network",children:[]},{value:"Link",id:"link",children:[]}]}],b={toc:d};function s(e){var n=e.components,t=Object(r.a)(e,o);return Object(i.b)("wrapper",Object(a.a)({},b,t,{components:n,mdxType:"MDXLayout"}),Object(i.b)("p",null,"This guide aims to give some insights about running ",Object(i.b)("a",{parentName:"p",href:"https://www.docker.com/"},"Docker")," containers, volumes and networks directly using ",Object(i.b)("inlineCode",{parentName:"p"},"docker run"),"."),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},"\ud83d\udeab This page does not aims to be a comprehensive Docker tutorial, see the ",Object(i.b)("a",{parentName:"p",href:"https://docs.docker.com/get-started/"},"official documentation")," if you want to know more about Docker.")),Object(i.b)("hr",null),Object(i.b)("h2",{id:"basic-docker-commands"},"Basic Docker commands"),Object(i.b)("h3",{id:"run-a-container"},"Run a container"),Object(i.b)("p",null,"A Docker image can be run to create a container in 2 ways"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"-it")," Interactive: the process is attached to the terminal and you can stop it using ctrl+C"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"-d")," Detached: the process is detached and will continue if you exit the terminal.")),Object(i.b)("hr",null),Object(i.b)("h3",{id:"stop-a-container"},"Stop a container"),Object(i.b)("p",null,"To get a Docker container ID and stop it:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell"},"docker ps\ndocker stop my-container\n")),Object(i.b)("p",null,"Automatically delete a container after run\nYou can use the ",Object(i.b)("inlineCode",{parentName:"p"},"--rm")," flag to automatically delete a container after its run. It avoid accumulating containers and wasting memory."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell"},"docker run -it --rm my-container\n")),Object(i.b)("hr",null),Object(i.b)("h3",{id:"share-volumes"},"Share volumes"),Object(i.b)("p",null,"A lot of images will require input files, the best way to provide them is to share a volume from your system to the container. It can be done by using ",Object(i.b)("inlineCode",{parentName:"p"},"-v")," when ",Object(i.b)("inlineCode",{parentName:"p"},"docker run"),"."),Object(i.b)("p",null,"Let's say I have a ",Object(i.b)("inlineCode",{parentName:"p"},"/data/d2s-workspace/my-file.txt")," on my system, and I want to provide it as a container input file. "),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"I need to provide he ",Object(i.b)("inlineCode",{parentName:"li"},"-v")," flag with paths separated by a ",Object(i.b)("inlineCode",{parentName:"li"},":"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"before the user provide the path of the shared volume on his system"),Object(i.b)("li",{parentName:"ul"},"after the user provide the path it will be accessible from in the Docker container")))),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell"},'docker run -it -v /path/on/my/computer:/path/in/container my-container \\\n    --input-file "/path/in/container/my-file.txt"\n')),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"In this example we are sharing the ",Object(i.b)("inlineCode",{parentName:"li"},"/data/d2s-workspace")," volume from our system to ",Object(i.b)("inlineCode",{parentName:"li"},"/data")," in the Docker container. ",Object(i.b)("em",{parentName:"li"},"my-file.txt")," is then accessible as ",Object(i.b)("inlineCode",{parentName:"li"},"/data/my-file.txt")," in the container")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell"},'docker run -it -v /data/d2s-workspace:/data my-container \\\n    --input-file "/data/my-file.txt"\n')),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Windows requires to provide the drive when sharing volume (e.g. ",Object(i.b)("inlineCode",{parentName:"li"},"c:"),") and the command to be one line.")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell"},'docker run -it -v c:/data/d2s-workspace:/data my-container --input-file "/data/my-file.txt"\n')),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"We usually provide a relative path using ",Object(i.b)("inlineCode",{parentName:"li"},"$pwd)"))),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell"},'docker run -it -v $(pwd)/workspace:/data my-container --input-file "/data/my-file.txt"\n')),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},"To be tested on Windows.")),Object(i.b)("hr",null),Object(i.b)("h2",{id:"link-and-network"},"Link and network"),Object(i.b)("p",null,"Containers can be linked using 2 ways: ",Object(i.b)("inlineCode",{parentName:"p"},"--link")," flag and ",Object(i.b)("inlineCode",{parentName:"p"},"--network"),"."),Object(i.b)("h3",{id:"network"},"Network"),Object(i.b)("p",null,"Especially used when running services using docker-compose. The ",Object(i.b)("inlineCode",{parentName:"p"},"--link")," flag method can be easier to use in simple cases."),Object(i.b)("h4",{id:"example-of-a-network-setup-in-the-docker-composeyml"},"Example of a network setup in the ",Object(i.b)("a",{parentName:"h4",href:"https://github.com/MaastrichtU-IDS/data2services-pipeline/blob/master/docker-compose.yml"},"docker-compose.yml")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-yaml"},'version: "3"\nservices:\n  drill:\n    build: ./apache-drill\n    volumes:\n      - /data:/data:ro\n    ports:\n      - 8047:8047\n      - 31011:31010\n    tty: true\n    networks:\n      - network\n  \n  graphdb:\n    build: ./graphdb\n    volumes:\n      - /data/graphdb:/opt/graphdb/home\n      - /data/graphdb-import:/root/graphdb-import\n    ports:\n      - 7200:7200\n    networks:\n      - network\n  \nnetworks:\n  network:\n    driver: bridge\n')),Object(i.b)("h4",{id:"example-of-autor2rml-connecting-to-the-drill-container-through-a-network"},"Example of AutoR2RML connecting to the Drill container through a network"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell"},'docker run -it --rm -v /data:/data \\\n  --network network-pipeline_data2services \\\n  autor2rml -r \\\n  -j "jdbc:drill:drillbit=data2services-pipeline_drill_1:31011" \\\n  -o "/data/d2s-workspace/mapping.trig" -d "/data/d2s-workspace" -g "http://data2services/graph/autor2rml"\n')),Object(i.b)("hr",null),Object(i.b)("h3",{id:"link"},"Link"),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"--link")," is deprecated, Docker recommends to use ",Object(i.b)("inlineCode",{parentName:"p"},"--network"),". But the ",Object(i.b)("inlineCode",{parentName:"p"},"--link")," flag can be more convenient to use in simple case: e.g. when linking to a single service, you just need to provide the container name instead of setting up a whole network."),Object(i.b)("h4",{id:"how-to-use-link"},"How to use link"),Object(i.b)("p",null,"Let's say you have a frontend application that needs to query a backend application."),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Run the backend")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell"},"docker run -it --rm --name backend -p 8080:8080 backend-image\n")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"To access it as http://localhost:8080 in the frontend")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell"},"docker run -it --rm --name frontend --link backend:localhost frontend-image\n")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"To access it as http://backend:8080 in the frontend")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell"},"docker run -it --rm --name frontend --link backend:backend frontend-image\n")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"You can link to multiple backend in a frontend")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell"},"docker run -it --rm --name frontend --link backend-sql:backend-sql --link backend-redis:backend-redis frontend-image\n")),Object(i.b)("h4",{id:"example-of-autor2rml-connecting-to-drill-container-using-link"},"Example of AutoR2RML connecting to Drill container using link"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell"},'# Run Apache Drill service\ndocker run -dit --rm -p 8047:8047 -p 31011:31010 --name drill -v /data:/data:ro apache-drill\n\n# Run AutoR2RML, linking to the Apache Drill container\ndocker run -it --rm --link drill:drill -v /data:/data autor2rml \\\n    -j "jdbc:drill:drillbit=drill:31010" -r \\\n        -o "/data/d2s-workspace/mapping.trig" -d "/data/d2s-workspace" -g "http://data2services/graph/autor2rml"\n')))}s.isMDXComponent=!0},141:function(e,n,t){"use strict";t.d(n,"a",(function(){return s})),t.d(n,"b",(function(){return m}));var a=t(0),r=t.n(a);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function c(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var d=r.a.createContext({}),b=function(e){var n=r.a.useContext(d),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},s=function(e){var n=b(e.components);return r.a.createElement(d.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return r.a.createElement(r.a.Fragment,{},n)}},u=r.a.forwardRef((function(e,n){var t=e.components,a=e.mdxType,i=e.originalType,o=e.parentName,d=c(e,["components","mdxType","originalType","parentName"]),s=b(t),u=a,m=s["".concat(o,".").concat(u)]||s[u]||p[u]||i;return t?r.a.createElement(m,l(l({ref:n},d),{},{components:t})):r.a.createElement(m,l({ref:n},d))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var i=t.length,o=new Array(i);o[0]=u;var l={};for(var c in n)hasOwnProperty.call(n,c)&&(l[c]=n[c]);l.originalType=e,l.mdxType="string"==typeof e?e:a,o[1]=l;for(var d=2;d<i;d++)o[d]=t[d];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,t)}u.displayName="MDXCreateElement"}}]);